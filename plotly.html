<!DOCTYPE html>
<html>
<head>
    <title></title>
    <script src="js/plotly-latest.min.js" type="text/javascript"></script>
</head>
<body>
<div id="myDiv" style="width:100%;height:100%"></div>
</body>
<script>
    var NumSamples = 1 << 9;

    // [OneWeek]
    function uniformSample(r1, r2)
    {
        var x = Math.cos(2*Math.PI*r1) * Math.sqrt(1 - Math.pow(1 - 2*r2, 2));
        var y = Math.sin(2*Math.PI*r1) * Math.sqrt(1 - Math.pow(1 - 2*r2, 2));
        var z = 1 - 2*r2;
        return [x, y, z];
    }

    // [OneWeek]
    function cosWeightedSample(r1, r2)
    {
        var x = Math.cos(2*Math.PI*r1) * Math.sqrt(r2);
        var y = Math.sin(2*Math.PI*r1) * Math.sqrt(r2);
        var z = Math.sqrt(1 - r2);
        return [x, y, z];
    }

    function test(numSamples, sampling)
    {
        var list = [];
        for (var i = 0; i < numSamples; i++)
        {
            var r1 = Math.random();
            var r2 = Math.random();
            list.push(sampling(r1, r2));
        }
        return list;
    }

    function getElement(list, idx)
    {
        var l = [];
        for (var i = 0; i < list.length; i++)
        {
            var element = list[i];
            l.push(element[idx]);
        }
        return l;
    }

    // [PBRT]
    function uniformSampleDist(x, y)
    {
        var r = Math.sqrt(x);
        var theta = 2 * Math.PI * y;
        return [r * Math.cos(theta), r * Math.sin(theta)];
    }

    // [PBRT]
    function concentricSampleDisk(x, y)
    {
        var uOffset = [x, y].map(x => 2*x - 1);
        if (uOffset[0] == 0 && uOffset[1] == 0)
            return [0, 0];
        var theta, r;
        if (Math.abs(uOffset[0]) > Math.abs(uOffset[1]))
        {
            r = uOffset[0];
            theta = Math.PI/4 * (uOffset[1] / uOffset[0]);
        }
        else
        {
            r = uOffset[1];
            theta = Math.PI/2 - Math.PI/4 * (uOffset[0] / uOffset[1]);
        }
        return [Math.cos(theta), Math.sin(theta)].map(x => r*x);
    }

    // [PBRT]
    function cosineSampleHemisphere(u1, u2)
    {
        var d = concentricSampleDisk(u1, u2);
        var z = Math.sqrt(Math.max(0, 1 - d[0]*d[0] - d[1]*d[1]));
        return [d[0], d[1], z];
    }

    function scatter(samplingMethod, color)
    {
        var SamplingResult = test(NumSamples, samplingMethod);
        var trace = {
            x: getElement(SamplingResult, 0),
            y: getElement(SamplingResult, 1),
            z: getElement(SamplingResult, 2),
            mode: 'markers',
            marker: {
                size: 8,
                line: {
                    color: color,
                    width: 0.5
                },
                opacity: 0.2
            },
            type: 'scatter3d'
        };
        return trace;
    }

    var trace0 = scatter(uniformSample, 'rgba(217, 217, 217, 0.14)') ;
    var trace1 = scatter(cosWeightedSample, 'rgb(204, 204, 204)');
    var trace2 = scatter(cosineSampleHemisphere, 'rgb(4, 104, 204)');
    var data = [trace0, trace1, trace2];
    var layout = {margin: {
        l: 20,
        r: 20,
        b: 20,
        t: 20
    }};
    Plotly.newPlot('myDiv', data, layout);

</script>
</html>
